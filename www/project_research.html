<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é—®é¢˜ç ”ç©¶</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; padding-bottom: 80px; }
        
        /* åŠ¨æ€å¤´éƒ¨åŒºåŸŸ */
        .header-section { 
            color: white; 
            padding: 20px; 
            border-radius: 0 0 25px 25px; 
            margin-bottom: 30px; 
            transition: background 0.3s;
        }
        
        /* æ¨ªå‘æ»šåŠ¨å¯¼èˆª */
        .nav-scroller { 
            overflow-x: auto; 
            white-space: nowrap; 
            margin-bottom: 15px; 
            -webkit-overflow-scrolling: touch; 
            padding-bottom: 5px; /* é˜²æ­¢æ»šåŠ¨æ¡é®æŒ¡ */
        }
        .nav-scroller::-webkit-scrollbar { display: none; } /* éšè—æ»šåŠ¨æ¡ */
        
        .nav-scroller a { 
            color: rgba(255,255,255,0.8); 
            text-decoration: none; 
            margin-right: 10px; 
            border: 1px solid rgba(255,255,255,0.3); 
            padding: 6px 14px; 
            border-radius: 20px; 
            display: inline-block; 
            font-size: 0.9rem; 
            transition: all 0.2s;
        }
        .nav-scroller a.active { 
            background: white; 
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* é¡¹ç›®å¡ç‰‡ */
        .project-card { border: none; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }
        .accordion-button { background-color: white; color: #2c3e50; font-weight: bold; font-size: 1rem; padding: 18px; }
        .accordion-button:not(.collapsed) { background-color: #f8f9fa; box-shadow: none; }
        .accordion-button:focus { box-shadow: none; }
        
        .content-box { background: #fff; padding: 20px; border-top: 3px solid transparent; }
        .label-tag { display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: bold; margin-bottom: 8px; background: #e9ecef; color: #495057; }
        
        /* åº•éƒ¨æŒ‰é’®æ  */
        .footer-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; text-align: center; }
    </style>
</head>
<body>

    <div class="header-section animate__animated animate__fadeInDown" id="header-bg">
        <div class="nav-scroller" id="top-nav">
            <a href="project_research.html?bid=b1" data-id="b1">å¿…1</a>
            <a href="project_research.html?bid=b2" data-id="b2">å¿…2</a>
            <a href="project_research.html?bid=xb1" data-id="xb1">é€‰1</a>
            <a href="project_research.html?bid=xb2" data-id="xb2">é€‰2</a>
            <a href="project_research.html?bid=xb3" data-id="xb3">é€‰3</a>
        </div>
        
        <h2 class="fw-bold mb-1" id="page-title">é—®é¢˜ç ”ç©¶</h2>
        <p class="opacity-75 small mb-0">æ·±åº¦æ¢ç©¶ Â· æ‹“å±•æ€ç»´</p>
    </div>
    
    <div class="container" style="max-width: 900px;">
        <div class="accordion" id="projectAccordion">
            <div class="text-center py-5 text-muted" id="loading-tip">åŠ è½½ä¸­...</div>
        </div>
        <div style="height: 20px;"></div>
    </div>

    <div class="footer-bar">
        <a href="index.html" class="btn btn-secondary rounded-pill px-4 mx-2">ğŸ  é¦–é¡µ</a>
        <button id="map-btn" class="btn btn-primary rounded-pill px-4 mx-2 shadow text-white">ğŸ—ºï¸ åœ°å›¾</button>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    <script>
        // 1. è·å– URL å‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const bid = urlParams.get('bid') || 'b1';
        
        // 2. è·å–å½“å‰ä¹¦ç±ä¿¡æ¯ (æ¥è‡ª data.js çš„ books å¯¹è±¡)
        const currentBook = books[bid];
        const themeColor = currentBook ? currentBook.color : '#3498db';
        const titlePrefix = currentBook ? currentBook.title : 'æœªçŸ¥ä¹¦ç±';

        // 3. æ¸²æŸ“ UI æ ·å¼
        // è®¾ç½®å¤´éƒ¨èƒŒæ™¯æ¸å˜
        document.getElementById('header-bg').style.background = `linear-gradient(135deg, ${themeColor} 0%, #2c3e50 100%)`;
        
        // è®¾ç½®æ ‡é¢˜
        document.getElementById('page-title').innerHTML = `${currentBook.icon} ${titlePrefix} Â· é—®é¢˜ç ”ç©¶`;
        
        // è®¾ç½®é¡¶éƒ¨å¯¼èˆªé«˜äº®
        const navLinks = document.querySelectorAll('#top-nav a');
        navLinks.forEach(link => {
            if (link.getAttribute('data-id') === bid) {
                link.classList.add('active');
                link.style.color = themeColor;
                // è‡ªåŠ¨æ»šåŠ¨å¯¼èˆªæ åˆ°å½“å‰é¡¹
                link.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        });

        // è®¾ç½®åº•éƒ¨â€œåœ°å›¾â€æŒ‰é’®æ ·å¼å’Œé“¾æ¥
        const mapBtn = document.getElementById('map-btn');
        mapBtn.style.backgroundColor = themeColor;
        mapBtn.style.borderColor = themeColor;
        mapBtn.onclick = function() {
            window.location.href = `chapter_map.html?bid=${bid}`;
        };

        // 4. æ¸²æŸ“ç ”ç©¶é¡¹ç›®åˆ—è¡¨
        const container = document.getElementById('projectAccordion');
        const projects = research_projects[bid] || [];

        if (projects.length === 0) {
            container.innerHTML = `
                <div class="alert alert-info text-center shadow-sm border-0" style="background: rgba(255,255,255,0.9); color: ${themeColor}">
                    ğŸš§ æœ¬å†Œå†…å®¹æ­£åœ¨å»ºè®¾ä¸­...
                </div>`;
        } else {
            let html = '';
            projects.forEach((proj, index) => {
                const delay = index * 0.1; // åŠ¨ç”»å»¶è¿Ÿ
                html += `
                <div class="accordion-item project-card animate__animated animate__fadeInUp" style="animation-delay: ${delay}s;">
                    <h2 class="accordion-header" id="heading${index}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}" style="color: ${themeColor}">
                            <span class="me-3 fs-3">${proj.icon}</span>
                            <span class="text-dark">${proj.title}</span>
                        </button>
                    </h2>
                    <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#projectAccordion">
                        <div class="accordion-body content-box" style="border-top-color: ${themeColor}">
                            <div class="mb-3">
                                <span class="label-tag">ğŸ’¡ ä¸»è¦è§‚ç‚¹ä¸æ€è·¯</span>
                                <div class="text-secondary small mt-2 lh-base">${proj.points}</div>
                            </div>
                            <div>
                                <span class="label-tag">ğŸ“ˆ ç ”ç©¶è¶‹åŠ¿ä¸ä»·å€¼</span>
                                <div class="text-secondary small mt-2 lh-base">${proj.value}</div>
                            </div>
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // 5. å¤„ç†è‡ªåŠ¨å±•å¼€é€»è¾‘ (æ¥è‡ª URL çš„ open å‚æ•°)
        const openIdx = urlParams.get('open');
        if (openIdx !== null) {
            // ä½¿ç”¨ Bootstrap çš„ API å±•å¼€
            const targetId = `#collapse${openIdx}`;
            const element = document.querySelector(targetId);
            if (element) {
                // ç­‰å¾… DOM æ¸²æŸ“å®Œæ¯•
                setTimeout(() => {
                    const bsCollapse = new bootstrap.Collapse(element, { show: true });
                    // æ»šåŠ¨åˆ°è¯¥å…ƒç´ 
                    element.previousElementSibling.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }
    </script>
</body>
</html>