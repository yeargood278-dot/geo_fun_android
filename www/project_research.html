<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—®é¢˜ç ”ç©¶ - åœ°ç†ä¹è¯¾å ‚</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; padding-bottom: 60px; }
        
        /* å¤´éƒ¨æ ·å¼ï¼ŒèƒŒæ™¯è‰²å°†ç”±JSåŠ¨æ€æ§åˆ¶ */
        .header-section { 
            color: white; 
            padding: 20px; 
            border-radius: 0 0 25px 25px; 
            margin-bottom: 30px; 
            transition: background 0.5s ease;
        }
        
        /* é¡¶éƒ¨ä¹¦ç±å¯¼èˆª */
        .nav-scroller { overflow-x: auto; white-space: nowrap; margin-bottom: 15px; -webkit-overflow-scrolling: touch; }
        .nav-scroller a { 
            color: rgba(255,255,255,0.8); 
            text-decoration: none; 
            margin-right: 10px; 
            border: 1px solid rgba(255,255,255,0.3); 
            padding: 4px 10px; 
            border-radius: 15px; 
            display: inline-block; 
            font-size: 0.85rem; 
            transition: all 0.3s;
        }
        .nav-scroller a.active { 
            background: white; 
            font-weight: bold; 
            /* æ–‡å­—é¢œè‰²ç”±JSåŠ¨æ€è®¾ç½® */
        }
        
        /* å¡ç‰‡ä¸æŠ˜å é¢æ¿æ ·å¼ */
        .project-card { border: none; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }
        .accordion-button { background-color: white; color: #2c3e50; font-weight: bold; font-size: 1rem; padding: 15px; border-radius: 15px !important; }
        .accordion-button:not(.collapsed) { background-color: #f8f9fa; box-shadow: none; /* æ–‡å­—é¢œè‰²ç”±JSåŠ¨æ€è®¾ç½® */ }
        .accordion-button:focus { box-shadow: none; }
        
        /* å†…å®¹åŒºåŸŸæ ·å¼ */
        .content-box { background: #fff; padding: 20px; border-top: 2px solid #ddd; /* è¾¹æ¡†è‰²ç”±JSåŠ¨æ€è®¾ç½® */ }
        .label-tag { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; margin-bottom: 8px; background: #e9ecef; color: #495057; }
    </style>
</head>
<body>
    <div id="header-section" class="header-section animate__animated animate__fadeInDown">
        <div class="nav-scroller" id="book-nav">
            <a href="project_research.html?bid=b1" data-bid="b1">å¿…1</a>
            <a href="project_research.html?bid=b2" data-bid="b2">å¿…2</a>
            <a href="project_research.html?bid=xb1" data-bid="xb1">é€‰1</a>
            <a href="project_research.html?bid=xb2" data-bid="xb2">é€‰2</a>
            <a href="project_research.html?bid=xb3" data-bid="xb3">é€‰3</a>
        </div>
        <h2 class="fw-bold mb-1" id="page-title">åŠ è½½ä¸­...</h2>
        <p class="opacity-75 small mb-0">æ·±åº¦æ¢ç©¶ Â· æ‹“å±•æ€ç»´</p>
    </div>
    
    <div class="container" style="max-width: 900px;">
        <div class="accordion" id="projectAccordion">
            <div class="text-center py-5 text-muted">
                <div class="spinner-border text-secondary" role="status"></div>
                <div class="mt-2">æ­£åœ¨åŠ è½½ç ”ç©¶è¯¾é¢˜...</div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="index.html" class="btn btn-secondary rounded-pill px-4 mx-2 btn-sm">ğŸ  é¦–é¡µ</a>
            <a id="map-btn" href="#" class="btn btn-primary rounded-pill px-4 mx-2 btn-sm shadow" style="border:none;">ğŸ—ºï¸ åœ°å›¾</a>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    
    <script src="data_zoo.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. è·å– URL å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const bid = urlParams.get('bid') || 'b1'; // é»˜è®¤ä¸º b1
            
            // 2. ä» data_zoo.js è·å–é…ç½®ä¿¡æ¯
            // ç¡®ä¿ data_zoo.js å·²æ­£ç¡®åŠ è½½
            if (typeof books === 'undefined' || typeof research_projects === 'undefined') {
                document.getElementById('projectAccordion').innerHTML = '<div class="alert alert-danger">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ data_zoo.js æ–‡ä»¶è·¯å¾„ã€‚</div>';
                return;
            }

            const bookConfig = books[bid];
            const currentProjects = research_projects[bid] || [];
            
            // å®šä¹‰ç‰¹å®šæ˜¾ç¤ºçš„æ ‡é¢˜å‰ç¼€ (æ¨¡æ‹ŸåŸPHPé€»è¾‘)
            const titleMap = {
                'b1': 'ğŸŒ å¿…ä¿®ä¸€',
                'b2': 'ğŸ”¥ å¿…ä¿®äºŒ',
                'xb1': 'ğŸ¶ é€‰å¿…ä¸€',
                'xb2': 'ğŸ° é€‰å¿…äºŒ',
                'xb3': 'ğŸ¼ é€‰å¿…ä¸‰'
            };
            const titlePrefix = titleMap[bid] || bookConfig.title;
            const themeColor = bookConfig.color || '#3498db';

            // 3. æ¸²æŸ“é¡µé¢è§†è§‰å…ƒç´ 
            
            // è®¾ç½®æ ‡é¢˜å’ŒèƒŒæ™¯
            document.title = `é—®é¢˜ç ”ç©¶ - ${titlePrefix}`;
            document.getElementById('page-title').innerText = `${titlePrefix} é—®é¢˜ç ”ç©¶`;
            const headerSection = document.getElementById('header-section');
            headerSection.style.background = `linear-gradient(135deg, ${themeColor} 0%, #2c3e50 100%)`;

            // è®¾ç½®åº•éƒ¨åœ°å›¾æŒ‰é’®
            const mapBtn = document.getElementById('map-btn');
            mapBtn.href = `chapter_map.html?bid=${bid}`; // æ³¨æ„æ”¹ä¸º .html
            mapBtn.style.background = themeColor;

            // è®¾ç½®å¯¼èˆªé«˜äº®
            const navLinks = document.querySelectorAll('#book-nav a');
            navLinks.forEach(link => {
                if (link.getAttribute('data-bid') === bid) {
                    link.classList.add('active');
                    link.style.color = themeColor;
                } else {
                    link.classList.remove('active');
                    link.style.color = 'rgba(255,255,255,0.8)';
                }
            });

            // 4. æ¸²æŸ“ç ”ç©¶è¯¾é¢˜åˆ—è¡¨ (Accordion)
            const container = document.getElementById('projectAccordion');
            
            if (currentProjects.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5 text-muted bg-white rounded-3 shadow-sm">
                        <div class="fs-1">ğŸ“­</div>
                        <p class="mt-2">æœ¬å†Œæš‚æ— ç ”ç©¶è¯¾é¢˜æ•°æ®</p>
                    </div>`;
            } else {
                let htmlContent = '';
                currentProjects.forEach((proj, index) => {
                    // åŠ¨ç”»å»¶è¿Ÿ
                    const delay = index * 0.05;
                    
                    htmlContent += `
                    <div class="accordion-item project-card animate__animated animate__fadeInUp" style="animation-delay: ${delay}s;">
                        <h2 class="accordion-header" id="heading${index}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}" style="--theme-color: ${themeColor}">
                                <span class="me-3 fs-3">${proj.icon}</span>
                                ${proj.title}
                            </button>
                        </h2>
                        <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#projectAccordion">
                            <div class="accordion-body content-box" style="border-top-color: ${themeColor}">
                                <div class="mb-3">
                                    <span class="label-tag">ğŸ’¡ æ ¸å¿ƒè§‚ç‚¹</span>
                                    <div class="text-secondary small mt-1">${proj.points}</div>
                                </div>
                                <div>
                                    <span class="label-tag">ğŸ“ˆ ä»·å€¼</span>
                                    <div class="text-secondary small mt-1">${proj.value}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                });
                container.innerHTML = htmlContent;
            }

            // 5. åŠ¨æ€æ³¨å…¥ CSS ä»¥æ§åˆ¶å±•å¼€æ—¶çš„é¢œè‰² (è§£å†³ inline style åœ¨ä¼ªç±»ä¸Šæ— æ•ˆçš„é—®é¢˜)
            const style = document.createElement('style');
            style.innerHTML = `
                .accordion-button:not(.collapsed) {
                    color: ${themeColor} !important;
                }
            `;
            document.head.appendChild(style);

            // 6. å¤„ç†è‡ªåŠ¨æ‰“å¼€ (URL param: open=index)
            const openIdx = urlParams.get('open');
            if (openIdx !== null) {
                // ç¨å¾®å»¶è¿Ÿä»¥ç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                    const targetCollapse = document.getElementById('collapse' + openIdx);
                    const targetBtn = document.querySelector(`button[data-bs-target="#collapse${openIdx}"]`);
                    
                    if (targetCollapse && targetBtn) {
                        // ä½¿ç”¨ Bootstrap API å±•å¼€
                        new bootstrap.Collapse(targetCollapse, { show: true });
                        // æ»šåŠ¨åˆ°è§†å›¾
                        setTimeout(() => targetBtn.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300);
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>