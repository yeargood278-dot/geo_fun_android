<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ°ç†ä¹è¯¾å ‚ - å­¦ä¹ ä¸­å¿ƒ</title>
    <style>
        /* ====================
           1. åŸºç¡€æ ·å¼ä¸å¸ƒå±€ä¿®å¤
           ==================== */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            height: 100vh; /* è§†å£é«˜åº¦ */
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            overflow: hidden; /* ç¦æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ï¼Œåªå…è®¸å¡ç‰‡å†…éƒ¨æ»šåŠ¨ */
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  - é˜²æ­¢è¢«å‹ç¼© */
        .header {
            width: 100%;
            height: 60px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            justify-content: space-between;
            box-sizing: border-box;
            flex-shrink: 0; /* å…³é”®ï¼šç¦æ­¢å¤´éƒ¨åœ¨ç©ºé—´ä¸è¶³æ—¶ç¼©å° */
            z-index: 100;
        }

        .back-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .back-btn:hover { background: #c0392b; }

        .course-title {
            font-size: 18px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }

        /* ====================
           2. PPT å®¹å™¨åŒºåŸŸ
           ==================== */
        .ppt-container {
            flex: 1; /* å æ®å‰©ä½™æ‰€æœ‰ç©ºé—´ */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden; /* å…³é”®ï¼šé˜²æ­¢å†…éƒ¨å†…å®¹æ’‘ç ´å®¹å™¨ */
            min-height: 0;    /* å…³é”®ï¼šFlexå­é¡¹æ»šåŠ¨çš„å¿…è¦å±æ€§ */
        }

        .slide-card {
            width: 100%;
            max-width: 900px;
            height: 100%; /* å……æ»¡å®¹å™¨ */
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* è§’è‰²å¤´éƒ¨ - å›ºå®šé«˜åº¦ */
        .role-header {
            height: 80px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            border-bottom: 2px solid #f0f0f0;
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            margin-right: 15px;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .role-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        /* å†…å®¹åŒºåŸŸ - å¯æ»šåŠ¨ */
        .slide-content {
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            padding: 30px 40px;
            font-size: 20px;
            line-height: 1.6;
            color: #444;
            overflow-y: auto; /* å…³é”®ï¼šå†…å®¹è¿‡å¤šæ—¶ï¼Œåªåœ¨è¿™é‡Œæ»šåŠ¨ */
            -webkit-overflow-scrolling: touch; /* ç§»åŠ¨ç«¯å¹³æ»‘æ»šåŠ¨ */
        }

        .slide-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }
        
        /* å›¾ç‰‡æˆ–å†…å®¹è‡ªé€‚åº” */
        .slide-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 10px 0;
        }

        /* åº•éƒ¨æ§åˆ¶æ  - å›ºå®šåœ¨åº•éƒ¨ */
        .controls {
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: center; /* å±…ä¸­å¯¹é½å†…å®¹ */
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            background: #fff; /* ç»™ä¸ªèƒŒæ™¯è‰²é˜²æ­¢é€è§† */
            border-top: 1px solid #eee;
            flex-shrink: 0; /* å…³é”®ï¼šç¦æ­¢åº•éƒ¨è¢«å‹ç¼©æ¶ˆå¤± */
            z-index: 100;
        }
        
        .controls-inner {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 10px 25px;
            border-radius: 30px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-weight: bold;
        }
        .btn:active { transform: scale(0.95); }
        .btn-prev { background: #95a5a6; color: white; }
        .btn-next { background: #3498db; color: white; }
        .btn:disabled { background: #e0e0e0; color: #aaa; cursor: not-allowed; transform: none; box-shadow: none; }

        .progress {
            font-size: 16px;
            color: #7f8c8d;
            font-weight: bold;
            background: #f8f9fa;
            padding: 5px 15px;
            border-radius: 15px;
        }

        /* ====================
           3. åŠ¨ç”»ä¸è§’è‰²é…è‰²
           ==================== */
        .fadeIn { animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* (å…¶ä»–åŠ¨ç”»ä¿æŒåŸæ ·ï¼Œçœç•¥ä»¥èŠ‚çœç©ºé—´ï¼ŒåŠŸèƒ½ä¸å—å½±å“) */

        /* è§’è‰²é…è‰² */
        .role-nick { background-color: #fff3e0; color: #e67e22; border-bottom-color: #e67e22; }
        .role-judy { background-color: #f3e5f5; color: #9b59b6; border-bottom-color: #9b59b6; }
        .role-flash { background-color: #e8f5e9; color: #27ae60; border-bottom-color: #27ae60; }
        .role-bogo { background-color: #eceff1; color: #2c3e50; border-bottom-color: #2c3e50; }
        .role-default { background-color: #f5f5f5; color: #333; }
        
        /* è§’è‰²å¤´åƒèƒŒæ™¯å¾®è°ƒ */
        .role-header .avatar { background: white; }
    </style>
</head>
<body>

    <div class="header">
        <div class="course-title" id="course-header-title">åŠ è½½ä¸­...</div>
        <button class="back-btn" onclick="goBack()">é€€å‡ºå­¦ä¹ </button>
    </div>

    <div class="ppt-container">
        <div id="slide-card" class="slide-card">
            <div style="padding:50px; text-align:center; color:#666; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
                <div style="font-size:40px; margin-bottom:20px;">â³</div>
                æ­£åœ¨è¯»å–è¯¾ç¨‹æ•°æ®...
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="controls-inner">
            <button id="prev-btn" class="btn btn-prev" onclick="changeSlide(-1)">ä¸Šä¸€é¡µ</button>
            <div id="progress-text" class="progress">-- / --</div>
            <button id="next-btn" class="btn btn-next" onclick="changeSlide(1)">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

    <script src="data_zoo.js"></script>

    <script>
        // ==========================
        // é€»è¾‘æ§åˆ¶è„šæœ¬
        // ==========================

        let currentCourseId = null;
        let currentSlideIndex = 0;
        let courseData = null;

        // 1. åˆå§‹åŒ–
        window.onload = function() {
            // å®‰å…¨æ£€æŸ¥ï¼šæ£€æŸ¥ data_zoo.js æ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof courses === 'undefined') {
                showError("æ•°æ®æ–‡ä»¶ (data_zoo.js) åŠ è½½å¤±è´¥æˆ–æœªå®šä¹‰ 'courses' å¯¹è±¡ã€‚");
                return;
            }

            // è·å–å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            currentCourseId = urlParams.get('id');

            // æ£€æŸ¥è¯¾ç¨‹IDæœ‰æ•ˆæ€§
            if (!currentCourseId || !courses[currentCourseId]) {
                // å¦‚æœæ²¡æœ‰IDï¼Œå°è¯•é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªç”¨äºæµ‹è¯•ï¼ˆå¯é€‰ï¼‰ï¼Œè¿™é‡Œç›´æ¥æŠ¥é”™
                showError("æœªæ‰¾åˆ°è¯¥è¯¾ç¨‹æ•°æ® (ID: " + currentCourseId + ")ã€‚<br>è¯·è¿”å›åœ°å›¾é‡æ–°è¿›å…¥ã€‚");
                return;
            }

            // åŠ è½½æ•°æ®
            courseData = courses[currentCourseId];
            
            // è®¾ç½®æ ‡é¢˜
            document.title = "åœ°ç†ä¹ - " + courseData.title;
            document.getElementById('course-header-title').innerText = courseData.title;

            // æ¸²æŸ“ç¬¬ä¸€é¡µ
            renderSlide(0);
        };

        // é”™è¯¯å¤„ç†æ˜¾ç¤ºå‡½æ•°
        function showError(msg) {
            const card = document.getElementById('slide-card');
            card.innerHTML = `
                <div style="padding:40px; text-align:center; color:#e74c3c; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
                    <div style="font-size:50px; margin-bottom:20px;">âš ï¸</div>
                    <h3>å‡ºé”™äº†</h3>
                    <p>${msg}</p>
                    <button class="btn btn-next" onclick="goBack()" style="margin-top:20px;">è¿”å›ä¸Šä¸€é¡µ</button>
                </div>`;
            document.getElementById('prev-btn').disabled = true;
            document.getElementById('next-btn').disabled = true;
            document.getElementById('course-header-title').innerText = "é”™è¯¯";
        }

        // 2. æ¸²æŸ“å¹»ç¯ç‰‡
        function renderSlide(index) {
            if (!courseData || !courseData.ppt) return;

            // è¾¹ç•Œæ£€æŸ¥
            if (index < 0) index = 0;
            if (index >= courseData.ppt.length) index = courseData.ppt.length - 1;
            
            currentSlideIndex = index;
            const slide = courseData.ppt[currentSlideIndex];

            // è·å– DOM
            const card = document.getElementById('slide-card');
            
            // è·å–è§’è‰²ä¿¡æ¯
            const roleInfo = getRoleInfo(slide.role);
            // ç¡®ä¿ visual å­˜åœ¨
            const visualEmoji = getVisualEmoji(slide.visual || '');
            const animClass = slide.anim_type || 'fadeIn';

            // æ„å»º HTML
            // æ³¨æ„ï¼šslide-content å¿…é¡»åŒ…å« overflow-y: auto æ‰èƒ½åœ¨å†…å®¹è¿‡å¤šæ—¶æ»šåŠ¨
            const html = `
                <div class="role-header role-${slide.role || 'default'}">
                    <div class="avatar">${roleInfo.emoji}</div>
                    <div class="role-name">${roleInfo.name}</div>
                </div>
                <div class="slide-content">
                    <div class="${animClass}">
                        <div class="slide-title">
                            ${visualEmoji} ${slide.title}
                        </div>
                        <div class="text-body" style="white-space: pre-wrap;">${slide.content}</div>
                    </div>
                </div>
            `;

            card.innerHTML = html;

            // æ›´æ–°åº•éƒ¨çŠ¶æ€
            updateControls();
        }

        function updateControls() {
            const total = courseData.ppt.length;
            const current = currentSlideIndex + 1;
            
            document.getElementById('progress-text').innerText = `${current} / ${total}`;
            document.getElementById('prev-btn').disabled = (currentSlideIndex === 0);
            
            const nextBtn = document.getElementById('next-btn');
            if (currentSlideIndex === total - 1) {
                nextBtn.innerText = "è¿›å…¥è€ƒæ ¸ ğŸ“";
                nextBtn.style.backgroundColor = "#2ecc71"; // ç»¿è‰²
                nextBtn.style.boxShadow = "0 4px 10px rgba(46, 204, 113, 0.3)";
            } else {
                nextBtn.innerText = "ä¸‹ä¸€é¡µ";
                nextBtn.style.backgroundColor = "#3498db"; // è“è‰²
                nextBtn.style.boxShadow = "0 4px 6px rgba(0,0,0,0.1)";
            }
        }

        // 3. ç¿»é¡µæ§åˆ¶
        window.changeSlide = function(direction) {
            // å¦‚æœæ˜¯æœ€åä¸€é¡µç‚¹å‡»ä¸‹ä¸€æ­¥ -> è·³è½¬æµ‹éªŒ
            if (direction === 1 && currentSlideIndex === courseData.ppt.length - 1) {
                window.location.href = "quiz.html?id=" + currentCourseId;
                return;
            }
            renderSlide(currentSlideIndex + direction);
        };

        // 4. è¿”å›
        window.goBack = function() {
            if (document.referrer && document.referrer.indexOf(window.location.host) !== -1) {
                window.history.back();
            } else {
                // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œå°è¯•æ ¹æ®IDåˆ¤æ–­è¿”å›å“ªæœ¬ä¹¦çš„åœ°å›¾ï¼ˆç®€å•å›é€€åˆ°é¦–é¡µæˆ–ç‰¹å®šé¡µï¼‰
                window.location.href = 'index.html';
            }
        };

        // ==========================
        // å·¥å…·å‡½æ•°
        // ==========================

        function getRoleInfo(roleId) {
            const roles = {
                'nick': { name: 'å°¼å…‹ç‹', emoji: 'ğŸ¦Š' },
                'judy': { name: 'æœ±è¿ªå…”', emoji: 'ğŸ°' },
                'flash': { name: 'é—ªç”µ', emoji: 'ğŸ¦¥' },
                'bogo': { name: 'ç‰›å±€é•¿', emoji: 'ğŸƒ' },
                'max': { name: 'éº¦å…‹', emoji: 'ğŸ¶' },
                'snowball': { name: 'å°ç™½', emoji: 'ğŸ°' },
                'po': { name: 'é˜¿å®', emoji: 'ğŸ¼' },
                'tigress': { name: 'æ‚å¨‡è™', emoji: 'ğŸ¯' },
                'shifu': { name: 'å¸ˆçˆ¶', emoji: 'ğŸ¥‹' },
                'nezha': { name: 'å“ªå’', emoji: 'ğŸ”¥' },
                'aobing': { name: 'æ•–ä¸™', emoji: 'ğŸ‰' },
                'default': { name: 'åœ°ç†è®²å¸ˆ', emoji: 'ğŸ“' }
            };
            return roles[roleId] || roles['default'];
        }

        function getVisualEmoji(visualKey) {
            if (!visualKey) return '';
            const map = {
                'star': 'ğŸŒŸ', 'map': 'ğŸ—ºï¸', 'life': 'ğŸŒ±', 'fire': 'ğŸ”¥',
                'alert': 'âš ï¸', 'search': 'ğŸ”', 'time': 'â³', 'earth': 'ğŸŒ',
                'water': 'ğŸ’§', 'money': 'ğŸ’°', 'mountain': 'ğŸ”ï¸', 'rain': 'ğŸŒ§ï¸',
                'sun': 'â˜€ï¸', 'plane': 'âœˆï¸', 'ship': 'ğŸš¢', 'car': 'ğŸš—'
            };
            // æ¨¡ç³ŠåŒ¹é…
            for (const key in map) {
                if (visualKey.includes(key)) return map[key];
            }
            return 'ğŸ“Œ';
        }
    </script>
</body>
</html>