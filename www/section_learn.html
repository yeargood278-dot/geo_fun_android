<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°ç†ä¹è¯¾å ‚ - å­¦ä¹ ä¸­å¿ƒ</title>
    <style>
        /* ====================
           1. åŸºç¡€æ ·å¼
           ==================== */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ»šåŠ¨ */
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            width: 100%;
            height: 60px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            justify-content: space-between;
            box-sizing: border-box;
        }

        .back-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none; /* å‡å¦‚æ˜¯aæ ‡ç­¾ */
            font-size: 14px;
        }
        .back-btn:hover { background: #c0392b; }

        .course-title {
            font-size: 18px;
            font-weight: bold;
        }

        /* ====================
           2. PPT å®¹å™¨åŒºåŸŸ
           ==================== */
        .ppt-container {
            flex: 1; /* å æ®å‰©ä½™é«˜åº¦ */
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .slide-card {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }

        /* è§’è‰²å¤´éƒ¨ */
        .role-header {
            height: 80px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            margin-right: 15px;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .role-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        /* å†…å®¹åŒºåŸŸ */
        .slide-content {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-size: 22px;
            line-height: 1.6;
            color: #444;
            background-repeat: no-repeat;
            background-position: right bottom;
            background-size: 150px;
        }

        .slide-title {
            font-size: 32px;
            color: #2c3e50;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        /* åº•éƒ¨æ§åˆ¶æ  */
        .controls {
            width: 100%;
            max-width: 900px;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            background: transparent;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:active { transform: scale(0.95); }
        .btn-prev { background: #95a5a6; color: white; }
        .btn-next { background: #3498db; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        .progress {
            font-size: 18px;
            color: #7f8c8d;
            font-weight: bold;
        }

        /* ====================
           3. åŠ¨ç”»ç±» (å¯¹åº” data.js ä¸­çš„ anim_type)
           ==================== */
        .fadeIn { animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .slideInLeft { animation: slideInLeft 0.6s ease-out; }
        @keyframes slideInLeft { from { transform: translateX(-50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .slideInRight { animation: slideInRight 0.6s ease-out; }
        @keyframes slideInRight { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .zoomIn { animation: zoomIn 0.5s ease-out; }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .rotateIn { animation: rotateIn 0.6s ease-out; }
        @keyframes rotateIn { from { transform: rotate(-15deg); opacity: 0; } to { transform: rotate(0); opacity: 1; } }

        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        .pulse { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .slideInUp { animation: slideInUp 0.6s ease-out; }
        @keyframes slideInUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .swing { animation: swing 1s ease-in-out; }
        @keyframes swing { 20% { transform: rotate(15deg); } 40% { transform: rotate(-10deg); } 60% { transform: rotate(5deg); } 80% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }

        .bounceIn { animation: bounceIn 0.8s; }
        @keyframes bounceIn { 0%, 20%, 40%, 60%, 80%, 100% {transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);} 0% {opacity: 0; transform: scale3d(.3, .3, .3);} 20% {transform: scale3d(1.1, 1.1, 1.1);} 40% {transform: scale3d(.9, .9, .9);} 60% {opacity: 1; transform: scale3d(1.03, 1.03, 1.03);} 80% {transform: scale3d(.97, .97, .97);} 100% {opacity: 1; transform: scale3d(1, 1, 1);} }

        /* ====================
           4. è§’è‰²é…è‰² (å¯¹åº” data.js ä¸­çš„ role)
           ==================== */
        .role-nick { background-color: #e67e22; color: white; } /* ç‹ç‹¸æ©™ */
        .role-judy { background-color: #9b59b6; color: white; } /* å…”å­ç´« */
        .role-flash { background-color: #27ae60; color: white; } /* æ ‘æ‡’ç»¿ */
        .role-bogo { background-color: #2c3e50; color: white; } /* ç‰›å±€é•¿è“é»‘ */
        .role-po { background-color: #f1c40f; color: #333; }    /* ç†ŠçŒ«é»„ */
        .role-tigress { background-color: #d35400; color: white; } /* æ‚å¨‡è™æ©™çº¢ */
        .role-shifu { background-color: #ecf0f1; color: #333; }  /* å¸ˆçˆ¶ç™½ */
        
        /* é»˜è®¤èƒŒæ™¯è‰² */
        .bg-default { background: #ecf0f1; }
    </style>
</head>
<body>

    <div class="header">
        <div class="course-title" id="course-header-title">æ­£åœ¨åŠ è½½è¯¾ç¨‹...</div>
        <button class="back-btn" onclick="goBack()">è¿”å›åœ°å›¾</button>
    </div>

    <div class="ppt-container">
        <div id="slide-card" class="slide-card">
            <div style="padding:50px; text-align:center; color:#666;">
                æ­£åœ¨è¯»å–æ•°æ®ï¼Œè¯·ç¨å€™...
            </div>
        </div>
    </div>

    <div class="controls">
        <button id="prev-btn" class="btn btn-prev" onclick="changeSlide(-1)">ä¸Šä¸€é¡µ</button>
        <div id="progress-text" class="progress">0 / 0</div>
        <button id="next-btn" class="btn btn-next" onclick="changeSlide(1)">ä¸‹ä¸€é¡µ</button>
    </div>

    <script src="js/data.js"></script>

    <script>
        // ==========================
        // é€»è¾‘æ§åˆ¶è„šæœ¬
        // ==========================

        let currentCourseId = null;
        let currentSlideIndex = 0;
        let courseData = null;

        // 1. åˆå§‹åŒ–ï¼šè·å–URLå‚æ•°å¹¶åŠ è½½æ•°æ®
        window.onload = function() {
            // è·å– URL ä¸­çš„ id å‚æ•° (ä¾‹å¦‚ section_learn.html?id=c1s1)
            const urlParams = new URLSearchParams(window.location.search);
            currentCourseId = urlParams.get('id');

            console.log("Current Course ID:", currentCourseId);

            if (!currentCourseId || !courses[currentCourseId]) {
                alert("æœªæ‰¾åˆ°è¯¥è¯¾ç¨‹æ•°æ®ï¼è¯·è¿”å›åœ°å›¾é‡æ–°é€‰æ‹©ã€‚");
                document.getElementById('course-header-title').innerText = "è¯¾ç¨‹æœªæ‰¾åˆ°";
                return;
            }

            // è·å– data.js ä¸­çš„è¯¾ç¨‹æ•°æ®
            courseData = courses[currentCourseId];
            
            // è®¾ç½®é¡µé¢æ ‡é¢˜
            document.title = "åœ°ç†ä¹ - " + courseData.title;
            document.getElementById('course-header-title').innerText = courseData.title;

            // æ¸²æŸ“ç¬¬ä¸€é¡µ
            renderSlide(0);
        };

        // 2. æ¸²æŸ“å¹»ç¯ç‰‡æ ¸å¿ƒå‡½æ•°
        function renderSlide(index) {
            if (!courseData || !courseData.ppt) return;

            // èŒƒå›´æ£€æŸ¥
            if (index < 0) index = 0;
            if (index >= courseData.ppt.length) index = courseData.ppt.length - 1;
            
            currentSlideIndex = index;
            const slide = courseData.ppt[currentSlideIndex];

            // è·å– DOM å…ƒç´ 
            const card = document.getElementById('slide-card');
            
            // --- æ„é€  HTML ç»“æ„ ---
            
            // 2.1 è§’è‰²å¤´åƒä¸é…è‰²
            const roleInfo = getRoleInfo(slide.role);
            const roleClass = `role-${slide.role || 'default'}`;
            
            // 2.2 è§†è§‰å›¾æ ‡ (Visual) - ä½¿ç”¨ Emoji æ›¿ä»£å›¾ç‰‡ä»¥é˜²ä¸¢å¤±
            const visualEmoji = getVisualEmoji(slide.visual);

            // 2.3 åŠ¨ç”»æ•ˆæœ
            const animClass = slide.anim_type || 'fadeIn';

            // 2.4 ç”Ÿæˆ HTML
            const html = `
                <div class="role-header ${roleClass}">
                    <div class="avatar">${roleInfo.emoji}</div>
                    <div class="role-name">${roleInfo.name}</div>
                </div>
                <div class="slide-content ${animClass}">
                    <div class="slide-title">
                        ${visualEmoji} ${slide.title}
                    </div>
                    <div class="text-body">
                        ${slide.content}
                    </div>
                </div>
            `;

            // æ›´æ–° DOM
            card.innerHTML = html;

            // --- æ›´æ–°æ§åˆ¶æ çŠ¶æ€ ---
            document.getElementById('progress-text').innerText = `${currentSlideIndex + 1} / ${courseData.ppt.length}`;
            
            // æŒ‰é’®ç¦ç”¨çŠ¶æ€
            document.getElementById('prev-btn').disabled = (currentSlideIndex === 0);
            
            // å¦‚æœæ˜¯æœ€åä¸€é¡µï¼Œä¸‹ä¸€é¡µæŒ‰é’®å˜æˆâ€œè¿›å…¥è€ƒæ ¸â€é¢œè‰²å˜ç»¿
            const nextBtn = document.getElementById('next-btn');
            if (currentSlideIndex === courseData.ppt.length - 1) {
                nextBtn.innerText = "è¿›å…¥è€ƒæ ¸";
                nextBtn.style.backgroundColor = "#2ecc71"; // ç»¿è‰²
            } else {
                nextBtn.innerText = "ä¸‹ä¸€é¡µ";
                nextBtn.style.backgroundColor = "#3498db"; // è“è‰²
            }
        }

        // 3. ç¿»é¡µæ§åˆ¶ (å·²ä¿®å¤è·³è½¬é€»è¾‘)
        function changeSlide(direction) {
            const newIndex = currentSlideIndex + direction;
            
            // æ ¸å¿ƒä¿®å¤ç‚¹ï¼šå¦‚æœæ˜¯æœ€åä¸€é¡µç‚¹å‡»ä¸‹ä¸€é¡µ -> è·³è½¬åˆ°æµ‹éªŒé¡µé¢
            if (direction === 1 && currentSlideIndex === courseData.ppt.length - 1) {
                // è·³è½¬åˆ° quiz.htmlï¼Œå¹¶å¸¦ä¸Šå½“å‰è¯¾ç¨‹ID
                window.location.href = "quiz.html?id=" + currentCourseId;
                return;
            }

            renderSlide(newIndex);
        }

        // 4. è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            // è¿”å›å†å²è®°å½•ä¸Šä¸€é¡µï¼Œæˆ–è€…å¼ºåˆ¶è·³è½¬å›åœ°å›¾ä¸»é¡µ
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'index.html'; // å‡è®¾ä¸»é¡µæ˜¯ index.html
            }
        }

        // ==========================
        // è¾…åŠ©å·¥å…·å‡½æ•°
        // ==========================

        // è·å–è§’è‰²ä¿¡æ¯ (åå­—å’Œ Emoji å¤´åƒ)
        function getRoleInfo(roleId) {
            const roles = {
                // ç–¯ç‹‚åŠ¨ç‰©åŸ
                'nick': { name: 'å°¼å…‹ç‹', emoji: 'ğŸ¦Š' },
                'judy': { name: 'æœ±è¿ªå…”', emoji: 'ğŸ°' },
                'flash': { name: 'é—ªç”µ', emoji: 'ğŸ¦¥' },
                'bogo': { name: 'ç‰›å±€é•¿', emoji: 'ğŸƒ' },
                // çˆ±å® å¤§æœºå¯†
                'max': { name: 'éº¦å…‹', emoji: 'ğŸ¶' },
                'snowball': { name: 'å°ç™½', emoji: 'ğŸ°' },
                'gidget': { name: 'å•¾å•¾', emoji: 'ğŸ©' },
                'chloe': { name: 'å…‹æ´›ä¼Š', emoji: 'ğŸ±' },
                'duke': { name: 'æœè€å¤§', emoji: 'ğŸ•' },
                // å½¼å¾—å…”
                'peter': { name: 'å½¼å¾—å…”', emoji: 'ğŸ¥•' },
                'benjamin': { name: 'æœ¬æ°æ˜', emoji: 'ğŸ°' },
                'lily': { name: 'è‰è‰', emoji: 'ğŸ‘’' },
                'tod': { name: 'æ‰˜å¾·', emoji: 'ğŸ¦Š' },
                'jemima': { name: 'æ°ç±³ç›', emoji: 'ğŸ¦†' },
                // åŠŸå¤«ç†ŠçŒ«
                'po': { name: 'é˜¿å®', emoji: 'ğŸ¼' },
                'tigress': { name: 'æ‚å¨‡è™', emoji: 'ğŸ¯' },
                'shifu': { name: 'å¸ˆçˆ¶', emoji: 'ğŸ¥‹' },
                'ping': { name: 'å¹³å…ˆç”Ÿ', emoji: 'ğŸœ' },
                'crane': { name: 'ä»™é¹¤', emoji: 'ğŸ¦¢' },
                // é­”ç«¥é™ä¸–
                'nezha': { name: 'å“ªå’', emoji: 'ğŸ”¥' },
                'aobing': { name: 'æ•–ä¸™', emoji: 'ğŸ‰' },
                'taiyi': { name: 'å¤ªä¹™çœŸäºº', emoji: 'ğŸ¶' },
                'lijing': { name: 'æé–', emoji: 'ğŸ°' },
                'shengongbao': { name: 'ç”³å…¬è±¹', emoji: 'ğŸ†' },
                // é»˜è®¤
                'default': { name: 'è®²å¸ˆ', emoji: 'ğŸ“' }
            };
            return roles[roleId] || roles['default'];
        }

        // å°† visual å­—æ®µæ˜ å°„ä¸º Emoji å›¾æ ‡
        function getVisualEmoji(visualKey) {
            if (!visualKey) return '';
            
            // ç®€å•å…³é”®è¯åŒ¹é…
            if (visualKey.includes('star')) return 'ğŸŒŸ';
            if (visualKey.includes('map')) return 'ğŸ—ºï¸';
            if (visualKey.includes('life')) return 'ğŸŒ±';
            if (visualKey.includes('fire')) return 'ğŸ”¥';
            if (visualKey.includes('alert')) return 'âš ï¸';
            if (visualKey.includes('search')) return 'ğŸ”';
            if (visualKey.includes('time')) return 'â³';
            if (visualKey.includes('earth')) return 'ğŸŒ';
            if (visualKey.includes('water')) return 'ğŸ’§';
            if (visualKey.includes('money')) return 'ğŸ’°';
            if (visualKey.includes('mountain')) return 'ğŸ”ï¸';
            if (visualKey.includes('rain')) return 'ğŸŒ§ï¸';
            if (visualKey.includes('sun')) return 'â˜€ï¸';
            if (visualKey.includes('plane')) return 'âœˆï¸';
            if (visualKey.includes('ship')) return 'ğŸš¢';
            if (visualKey.includes('train')) return 'ğŸš‚';
            if (visualKey.includes('car')) return 'ğŸš—';
            if (visualKey.includes('tree')) return 'ğŸŒ²';
            if (visualKey.includes('factory')) return 'ğŸ­';
            
            return 'ğŸ“Œ'; // é»˜è®¤å›¾æ ‡
        }

    </script>
</body>
</html>